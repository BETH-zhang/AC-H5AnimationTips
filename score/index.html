<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        #result {
            position: relative;
            z-index: 9999;
        }
    </style>
</head>
<body>
    <div id="result"></div>
    <div id="main"></div>
    <div id="log"></div>
    <script>
        (function() {
            var lastTime = 0;
            var vendors = ['ms', 'moz', 'webkit', 'o'];
            for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
                window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];
                window.cancelAnimationFrame = window[vendors[x]+'CancelAnimationFrame'] 
                                        || window[vendors[x]+'CancelRequestAnimationFrame'];
            }
        
            if (!window.requestAnimationFrame)
                window.requestAnimationFrame = function(callback, element) {
                    var currTime = new Date().getTime();
                    var timeToCall = Math.max(0, 16 - (currTime - lastTime));
                    var id = window.setTimeout(function() { callback(currTime + timeToCall); }, 
                    timeToCall);
                    lastTime = currTime + timeToCall;
                    return id;
                };
        
            if (!window.cancelAnimationFrame)
                window.cancelAnimationFrame = function(id) {
                    clearTimeout(id);
                };
        }());
    </script>
    <script>
        const windowHeight = window.screen.availHeight;
        const windowWidth = window.screen.availWidth;
        const FRAME = 20;
        const NUM = 200;

        let main = document.querySelector('#main');
        let ul = document.createElement('ul');
        let ulList = [];
        main.appendChild(ul);

        for( let i = 0; i < NUM; i++) {
            let each = document.createElement('li');
            let { style } = each;
            style.display = 'block';
            style.width = '100px';
            style.height = '100px';
            style.position = 'absolute';
            style.top = '50%';
            style.left = '50%';
            style.marginLeft = '-50px';
            style.marginTop = '-50px';
            style.backgroundColor = ['red', 'yellow', 'green', 'blue'][(Math.floor(Math.random() * 10) + 1) % 4];
            ul.appendChild(each);
            ulList.push(each);
        }

        

        let lastTime = performance.now();

        for( let j = 0; j < NUM; j++) {
            let start = 1;
            let element = ulList[j];
            let r = Math.random();
            let r1 = Math.random() * 2 - 1;
            let r2 = Math.random() * 2 - 1;
            
            function step(time) {
                start = start - (1 - r) / FRAME;
                element.style.opacity = start;
                element.style.webkitTransform = "scale(" + start + ") translate(" + windowWidth * r1 + "px," + windowHeight * r2 + "px)";
                if (start > r) {
                    window.requestAnimationFrame(step);
                } else {
                    if(j === NUM-1){
                        const endTime = performance.now();
                        const t = endTime-lastTime;
                        const fps = 1000 * FRAME / t;
                        const score = Math.floor(10000 * fps / t)               
                        console.log(fps, score);
                        document.querySelector('#result').innerHTML = `fps: ${Math.round(fps)}, score: ${score}`;
                    }
                }
            }
            window.requestAnimationFrame(step);
        }
    </script>
</body>
</html>